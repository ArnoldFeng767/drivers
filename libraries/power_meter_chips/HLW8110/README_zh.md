# HLW8110电能计量芯片演示文档

## 概述

本文档提供了通过UART接口使用HLW8110电能计量芯片的演示指南。HLW8110是一款高精度电能计量IC，可用于测量交流/直流电压、电流、功率和相位角。

## 主要特性

- 电压测量（0.5V-5V输入范围）
- 电流测量（通过外部分流电阻）
- 有功功率计算
- 相位角测量
- 过压/欠压检测
- 过零检测
- 中断功能

## 硬件连接

1. 将HLW8110的UART引脚连接到MCU：
   - TX -> MCU RX
   - RX -> MCU TX
   - GND -> 共地
2. 通过适当的分压电路连接电压输入
3. 连接电流采样电阻（典型值1-10mΩ）

## 示例代码说明

### 1. 初始化

```python
hlw8110 = Hlw8110_uart(uart_n=UART.UART2)  # 使用UART2初始化
```

### 2. 基本测量功能

#### 读取电流

```python
curr, ic = hlw8110.read_i()  # 返回(原始值,转换系数)
```

- 实际电流计算：
  `实际电流 = (原始值 × 分流比例) / 转换系数`

#### 读取电压

```python
volt, uc = hlw8110.read_u()
```

- 实际电压计算：
  `实际电压 = (原始值 × 分压比例) / 转换系数`

#### 读取功率

```python
power, pc = hlw8110.read_power()
```

- 有功功率计算：
  `实际功率 = (原始值 × 电压比例 × 电流比例) / 转换系数`

#### 相位角

```python
angle = hlw8110.read_angle()  # 返回角度值
```

### 3. 高级功能

#### 过零检测

```python
hlw8110.zx_en(zx_type=3)  # 使能上升沿/下降沿检测
```

#### 中断配置

```python
# 使能欠压中断
hlw8110.int_en(int_type=11)

# 检查中断
flag = hlw8110.process_int()
if flag & 0x0800:
    print("检测到欠压！")
```

### 4. 完整演示输出

```
开始读取...
读取完成。
电流寄存器值：1258291，电流有效值转换系数：32768
电压寄存器值：3145728，电压有效值转换系数：32768
有功功率寄存器值：536870912，有功功率转换系数：32768
相位角：30.2
电压欠压中断已触发
```

## 校准说明

1. 电压校准：
   - 施加已知电压
   - 调整分压比例直到读数匹配
2. 电流校准：
   - 施加已知电流
   - 调整分流电阻值
3. 功率校准：
   - 使用标准负载验证
   - 必要时调整系数

## 故障排除

- **无读数**：检查UART连接和波特率（固定9600）
- **数值不正确**：确认参考电压和电阻值
- **中断不触发**：检查中断使能顺序

## 应用场景

- 智能排插
- 能源监测系统
- 电能质量分析
- 电器负载分析

详细寄存器说明和转换公式请参考HLW8110数据手册。